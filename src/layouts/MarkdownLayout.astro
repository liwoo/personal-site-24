---
import Layout from '~/layouts/PageLayout.astro';

import type { MetaData } from '~/types';

export interface Props {
  frontmatter: {
    title?: string;
  };
}

const { frontmatter } = Astro.props;

const metadata: MetaData = {
  title: frontmatter?.title,
};
---

<Layout metadata={metadata}>
  <section class="px-4 py-16 sm:px-6 mx-auto lg:px-8 lg:py-20 max-w-4xl">
    <h1 class="markdown-title font-bold font-heading text-4xl md:text-5xl leading-tighter tracking-tighter">{frontmatter.title}</h1>
    <div
      class="markdown-content mx-auto prose prose-lg max-w-4xl dark:prose-invert dark:prose-headings:text-slate-300 prose-md prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-headings:font-bold prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-img:rounded-md prose-img:shadow-lg mt-8"
    >
      <slot />
    </div>
  </section>
</Layout>

<style>
  .markdown-title {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
  }

  .markdown-title.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  .markdown-content {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.8s ease-out 0.2s, transform 0.8s ease-out 0.2s;
  }

  .markdown-content.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  /* Markdown element animations */
  .markdown-content :global(h2),
  .markdown-content :global(h3),
  .markdown-content :global(h4),
  .markdown-content :global(h5),
  .markdown-content :global(h6) {
    opacity: 0;
    transform: translateY(15px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .markdown-content :global(h2.is-visible),
  .markdown-content :global(h3.is-visible),
  .markdown-content :global(h4.is-visible),
  .markdown-content :global(h5.is-visible),
  .markdown-content :global(h6.is-visible) {
    opacity: 1;
    transform: translateY(0);
  }

  .markdown-content :global(p),
  .markdown-content :global(ul),
  .markdown-content :global(ol),
  .markdown-content :global(blockquote) {
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
  }

  .markdown-content :global(p.is-visible),
  .markdown-content :global(ul.is-visible),
  .markdown-content :global(ol.is-visible),
  .markdown-content :global(blockquote.is-visible) {
    opacity: 1;
    transform: translateY(0);
  }

  .markdown-content :global(pre),
  .markdown-content :global(img),
  .markdown-content :global(video) {
    opacity: 0;
    transform: scale(0.98);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .markdown-content :global(pre.is-visible),
  .markdown-content :global(img.is-visible),
  .markdown-content :global(video.is-visible) {
    opacity: 1;
    transform: scale(1);
  }
</style>

<script>
  const initMarkdownAnimations = () => {
    // Immediate animations for title and content container
    const markdownTitle = document.querySelector('.markdown-title');
    const markdownContent = document.querySelector('.markdown-content');

    setTimeout(() => {
      markdownTitle?.classList.add('animate-in');
      markdownContent?.classList.add('animate-in');
    }, 150);

    // Scroll-based animations for markdown elements
    const observerCallback = (entries: IntersectionObserverEntry[]) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
        }
      });
    };

    const observerOptions = {
      threshold: 0.15,
      rootMargin: '0px 0px -50px 0px',
    };

    const observer = new IntersectionObserver(observerCallback, observerOptions);

    // Observe markdown elements
    const markdownElements = document.querySelectorAll(
      '.markdown-content h2, .markdown-content h3, .markdown-content h4, .markdown-content h5, .markdown-content h6, ' +
      '.markdown-content p, .markdown-content ul, .markdown-content ol, .markdown-content blockquote, ' +
      '.markdown-content pre, .markdown-content img, .markdown-content video'
    );
    markdownElements.forEach((element) => observer.observe(element));
  };

  // Initial load
  window.addEventListener('load', initMarkdownAnimations);

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initMarkdownAnimations);
</script>
